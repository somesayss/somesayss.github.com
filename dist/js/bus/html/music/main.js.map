{"version":3,"sources":["webpack:///webpack/bootstrap 2e8a12564fde4c987cbd?8a83********************","webpack:///external \"jQuery\"?0cb8******","webpack:///external \"limit\"","webpack:///./src/js/bus/html/music/main.js"],"names":["$","require","limit","file","document","getElementById","audio","readerUrl","FileReader","readerBuffer","audioContext","window","AudioContext","analyser","createAnalyser","audioBufferSouceNode","createBufferSource","A1","canvas","context","getRealBuffer","buffer","Promise","resolve","reject","decodeAudioData","bindAudioWithBuffer","connect","destination","start","initCanvas","createElement","body","appendChild","width","height","getContext","parseData","maxWidth","oneMaxWidth","Math","floor","from","Array","map","val","key","top","drawCanvas","min","forEach","fillStyle","roundRect","apply","x","y","w","h","r","max","beginPath","moveTo","arcTo","closePath","fill","drawAudio","leg","frequencyBinCount","array","Uint8Array","getByteFrequencyData","num","reduce","a","b","toFixed","requestAnimationFrame","onload","e","src","target","result","play","then","onchange","data","files","readAsArrayBuffer"],"mappings":"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","file":"js/bus/html/music/main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/dist/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 2e8a12564fde4c987cbd","module.exports = jQuery;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jQuery\"\n// module id = 31\n// module chunks = 3 4 11 13 14 17 19 21 34 35 38","module.exports = limit;\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"limit\"\n// module id = 32\n// module chunks = 3 4 5 11 14 15 17 18 19 21 22 27 29 33 34 35 36 37 38","\"use strict\";\n\n// 依赖\nconst $ = require('$');\nconst limit = require('limit');\n\nlet file = document.getElementById('file');\nlet audio = document.getElementById('audio');\n\nlet readerUrl  = new FileReader();\nlet readerBuffer  = new FileReader();\n\nlet audioContext = new window.AudioContext();\nlet analyser = audioContext.createAnalyser();\nlet audioBufferSouceNode = audioContext.createBufferSource();\n\nwindow.A1 = audioBufferSouceNode;\n\nlet canvas = null;\nlet context = null;\n\nfunction getRealBuffer(buffer){\n\treturn new Promise((resolve, reject) => {\n\t\taudioContext.decodeAudioData(buffer, resolve, reject);\n\t});\n};\n\nfunction bindAudioWithBuffer(buffer){\n\taudioBufferSouceNode.connect(analyser);\n\tanalyser.connect(audioContext.destination);\n\taudioBufferSouceNode.buffer = buffer;\n\taudioBufferSouceNode.start();\n};\n\nfunction initCanvas(){\n\tcanvas = document.createElement('canvas');\n\tdocument.body.appendChild(canvas);\n\tcanvas.width = 200;\n\tcanvas.height = 40;\n\tcontext = canvas.getContext('2d');\n};\ninitCanvas();\n\nfunction parseData(){\n\tlet maxWidth = 200 - 5 * 10;\n\tlet oneMaxWidth = Math.floor( maxWidth / 10 );\n\treturn limit.from(new Array(10)).map((val, key) => {\n\t\tlet top = (oneMaxWidth + 5) * key;\n\t\treturn [top, 0, oneMaxWidth, 40];\n\t});\n};\n\nfunction drawCanvas(min){\n\treturn parseData().forEach((val, key) => {\n\t\tcontext.fillStyle = '#CCC';\n\t\tif( key < min ){\n\t\t\tcontext.fillStyle  = '#4d90fe';\n\t\t};\n\t\troundRect.apply(context, [...val, 3]);\n\t});\n};\n\nfunction roundRect(x, y, w, h, r){\n\tlet context = this;\n\tlet max = Math.min(w, h);\n\tif( r > max/2 ){\n\t\tr = max/2;\n\t};\n\tcontext.beginPath();\n\tcontext.moveTo(x+r, y);\n\tcontext.arcTo(x+w, y, x+w, y+h, r);\n\tcontext.arcTo(x+w, y+h, x, y+h, r);\n\tcontext.arcTo(x, y+h, x, y, r);\n\tcontext.arcTo(x, y, x+w, y, r);\n\tcontext.closePath();\n\tcontext.fill();\n};\n\nfunction drawAudio(){\n\tlet leg = analyser.frequencyBinCount;\n\tlet array = new Uint8Array(leg);\n    analyser.getByteFrequencyData(array);\n    let num = array.reduce((a,b) => a + b) / leg;\n    drawCanvas( limit(num/256*10).toFixed().val() );\n    requestAnimationFrame(drawAudio);\n};\n\nreaderUrl.onload = (e) => {\n\taudio.src = e.target.result;\n\taudio.play();\n};\n\nreaderBuffer.onload = (e) => {\n\tlet buffer = e.target.result;\n\treturn getRealBuffer(buffer).then((buffer) => {\n\t\treturn bindAudioWithBuffer(buffer);\n\t}).then(() => {\n\t\treturn drawAudio();\n\t});\n\n\t// let blob = new Blob([buffer]);\n\t// audio.src = window.URL.createObjectURL(blob);\n\t// audio.play();\n};\n\nfile.onchange = (e) => {\n\tlet data = file.files[0];\n\treaderBuffer.readAsArrayBuffer(data);\n};\n\n\n\n\n\n\n\n\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/bus/html/music/main.js"],"sourceRoot":""}