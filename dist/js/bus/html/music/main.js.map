{"version":3,"sources":["webpack:///js/bus/html/music/main.js","webpack:///webpack/bootstrap fecebfae0e394175949a?8394********","webpack:///external \"jQuery\"?0cb8******","webpack:///external \"limit\"?1d95********","webpack:///./src/js/bus/html/music/main.js"],"names":["modules","__webpack_require__","moduleId","installedModules","exports","module","id","loaded","call","m","c","p","0","2","jQuery","3","limit","35","_toConsumableArray","arr","Array","isArray","i","arr2","length","from","getRealBuffer","buffer","Promise","resolve","reject","audioContext","decodeAudioData","bindAudioWithBuffer","audioBufferSouceNode","connect","analyser","destination","start","initCanvas","canvas","document","createElement","body","appendChild","width","height","context","getContext","parseData","maxWidth","oneMaxWidth","Math","floor","map","val","key","top","drawCanvas","min","forEach","fillStyle","roundRect","apply","concat","x","y","w","h","r","this","max","beginPath","moveTo","arcTo","closePath","fill","drawAudio","leg","frequencyBinCount","array","Uint8Array","getByteFrequencyData","num","reduce","a","b","toFixed","requestAnimationFrame","file","getElementById","audio","readerUrl","FileReader","readerBuffer","window","AudioContext","createAnalyser","createBufferSource","A1","onload","e","src","target","result","play","then","onchange","data","files","readAsArrayBuffer"],"mappings":"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","file":"js/bus/html/music/main.js","sourcesContent":["/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"/dist/\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ({\n\n/***/ 0:\n/***/ function(module, exports, __webpack_require__) {\n\n\tmodule.exports = __webpack_require__(35);\n\n\n/***/ },\n\n/***/ 2:\n/***/ function(module, exports) {\n\n\tmodule.exports = jQuery;\n\n/***/ },\n\n/***/ 3:\n/***/ function(module, exports) {\n\n\tmodule.exports = limit;\n\n/***/ },\n\n/***/ 35:\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\n\t\n\t// 依赖\n\t\n\tfunction _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }\n\t\n\tvar $ = __webpack_require__(2);\n\tvar limit = __webpack_require__(3);\n\t\n\tvar file = document.getElementById('file');\n\tvar audio = document.getElementById('audio');\n\t\n\tvar readerUrl = new FileReader();\n\tvar readerBuffer = new FileReader();\n\t\n\tvar audioContext = new window.AudioContext();\n\tvar analyser = audioContext.createAnalyser();\n\tvar audioBufferSouceNode = audioContext.createBufferSource();\n\t\n\twindow.A1 = audioBufferSouceNode;\n\t\n\tvar canvas = null;\n\tvar context = null;\n\t\n\tfunction getRealBuffer(buffer) {\n\t\treturn new Promise(function (resolve, reject) {\n\t\t\taudioContext.decodeAudioData(buffer, resolve, reject);\n\t\t});\n\t};\n\t\n\tfunction bindAudioWithBuffer(buffer) {\n\t\taudioBufferSouceNode.connect(analyser);\n\t\tanalyser.connect(audioContext.destination);\n\t\taudioBufferSouceNode.buffer = buffer;\n\t\taudioBufferSouceNode.start();\n\t};\n\t\n\tfunction initCanvas() {\n\t\tcanvas = document.createElement('canvas');\n\t\tdocument.body.appendChild(canvas);\n\t\tcanvas.width = 200;\n\t\tcanvas.height = 40;\n\t\tcontext = canvas.getContext('2d');\n\t};\n\tinitCanvas();\n\t\n\tfunction parseData() {\n\t\tvar maxWidth = 200 - 5 * 10;\n\t\tvar oneMaxWidth = Math.floor(maxWidth / 10);\n\t\treturn limit.from(new Array(10)).map(function (val, key) {\n\t\t\tvar top = (oneMaxWidth + 5) * key;\n\t\t\treturn [top, 0, oneMaxWidth, 40];\n\t\t});\n\t};\n\t\n\tfunction drawCanvas(min) {\n\t\treturn parseData().forEach(function (val, key) {\n\t\t\tcontext.fillStyle = '#CCC';\n\t\t\tif (key < min) {\n\t\t\t\tcontext.fillStyle = '#4d90fe';\n\t\t\t};\n\t\t\troundRect.apply(context, [].concat(_toConsumableArray(val), [3]));\n\t\t});\n\t};\n\t\n\tfunction roundRect(x, y, w, h, r) {\n\t\tvar context = this;\n\t\tvar max = Math.min(w, h);\n\t\tif (r > max / 2) {\n\t\t\tr = max / 2;\n\t\t};\n\t\tcontext.beginPath();\n\t\tcontext.moveTo(x + r, y);\n\t\tcontext.arcTo(x + w, y, x + w, y + h, r);\n\t\tcontext.arcTo(x + w, y + h, x, y + h, r);\n\t\tcontext.arcTo(x, y + h, x, y, r);\n\t\tcontext.arcTo(x, y, x + w, y, r);\n\t\tcontext.closePath();\n\t\tcontext.fill();\n\t};\n\t\n\tfunction drawAudio() {\n\t\tvar leg = analyser.frequencyBinCount;\n\t\tvar array = new Uint8Array(leg);\n\t\tanalyser.getByteFrequencyData(array);\n\t\tvar num = array.reduce(function (a, b) {\n\t\t\treturn a + b;\n\t\t}) / leg;\n\t\tdrawCanvas(limit(num / 256 * 10).toFixed().val());\n\t\trequestAnimationFrame(drawAudio);\n\t};\n\t\n\treaderUrl.onload = function (e) {\n\t\taudio.src = e.target.result;\n\t\taudio.play();\n\t};\n\t\n\treaderBuffer.onload = function (e) {\n\t\tvar buffer = e.target.result;\n\t\treturn getRealBuffer(buffer).then(function (buffer) {\n\t\t\treturn bindAudioWithBuffer(buffer);\n\t\t}).then(function () {\n\t\t\treturn drawAudio();\n\t\t});\n\t\n\t\t// let blob = new Blob([buffer]);\n\t\t// audio.src = window.URL.createObjectURL(blob);\n\t\t// audio.play();\n\t};\n\t\n\tfile.onchange = function (e) {\n\t\tvar data = file.files[0];\n\t\treaderBuffer.readAsArrayBuffer(data);\n\t};\n\n/***/ }\n\n/******/ });\n\n\n/** WEBPACK FOOTER **\n ** js/bus/html/music/main.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/dist/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap fecebfae0e394175949a\n **/","module.exports = jQuery;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"jQuery\"\n ** module id = 2\n ** module chunks = 0 1 2 3 4 6 8 9 10 11\n **/","module.exports = limit;\n\n\n/*****************\n ** WEBPACK FOOTER\n ** external \"limit\"\n ** module id = 3\n ** module chunks = 0 1 2 3 4 5 6 7 8 9 10 11 12\n **/","\"use strict\";\n\n// 依赖\nconst $ = require('$');\nconst limit = require('limit');\n\nlet file = document.getElementById('file');\nlet audio = document.getElementById('audio');\n\nlet readerUrl  = new FileReader();\nlet readerBuffer  = new FileReader();\n\nlet audioContext = new window.AudioContext();\nlet analyser = audioContext.createAnalyser();\nlet audioBufferSouceNode = audioContext.createBufferSource();\n\nwindow.A1 = audioBufferSouceNode;\n\nlet canvas = null;\nlet context = null;\n\nfunction getRealBuffer(buffer){\n\treturn new Promise((resolve, reject) => {\n\t\taudioContext.decodeAudioData(buffer, resolve, reject);\n\t});\n};\n\nfunction bindAudioWithBuffer(buffer){\n\taudioBufferSouceNode.connect(analyser);\n\tanalyser.connect(audioContext.destination);\n\taudioBufferSouceNode.buffer = buffer;\n\taudioBufferSouceNode.start();\n};\n\nfunction initCanvas(){\n\tcanvas = document.createElement('canvas');\n\tdocument.body.appendChild(canvas);\n\tcanvas.width = 200;\n\tcanvas.height = 40;\n\tcontext = canvas.getContext('2d');\n};\ninitCanvas();\n\nfunction parseData(){\n\tlet maxWidth = 200 - 5 * 10;\n\tlet oneMaxWidth = Math.floor( maxWidth / 10 );\n\treturn limit.from(new Array(10)).map((val, key) => {\n\t\tlet top = (oneMaxWidth + 5) * key;\n\t\treturn [top, 0, oneMaxWidth, 40];\n\t});\n};\n\nfunction drawCanvas(min){\n\treturn parseData().forEach((val, key) => {\n\t\tcontext.fillStyle = '#CCC';\n\t\tif( key < min ){\n\t\t\tcontext.fillStyle  = '#4d90fe';\n\t\t};\n\t\troundRect.apply(context, [...val, 3]);\n\t});\n};\n\nfunction roundRect(x, y, w, h, r){\n\tlet context = this;\n\tlet max = Math.min(w, h);\n\tif( r > max/2 ){\n\t\tr = max/2;\n\t};\n\tcontext.beginPath();\n\tcontext.moveTo(x+r, y);\n\tcontext.arcTo(x+w, y, x+w, y+h, r);\n\tcontext.arcTo(x+w, y+h, x, y+h, r);\n\tcontext.arcTo(x, y+h, x, y, r);\n\tcontext.arcTo(x, y, x+w, y, r);\n\tcontext.closePath();\n\tcontext.fill();\n};\n\nfunction drawAudio(){\n\tlet leg = analyser.frequencyBinCount;\n\tlet array = new Uint8Array(leg);\n    analyser.getByteFrequencyData(array);\n    let num = array.reduce((a,b) => a + b) / leg;\n    drawCanvas( limit(num/256*10).toFixed().val() );\n    requestAnimationFrame(drawAudio);\n};\n\nreaderUrl.onload = (e) => {\n\taudio.src = e.target.result;\n\taudio.play();\n};\n\nreaderBuffer.onload = (e) => {\n\tlet buffer = e.target.result;\n\treturn getRealBuffer(buffer).then((buffer) => {\n\t\treturn bindAudioWithBuffer(buffer);\n\t}).then(() => {\n\t\treturn drawAudio();\n\t});\n\n\t// let blob = new Blob([buffer]);\n\t// audio.src = window.URL.createObjectURL(blob);\n\t// audio.play();\n};\n\nfile.onchange = (e) => {\n\tlet data = file.files[0];\n\treaderBuffer.readAsArrayBuffer(data);\n};\n\n\n\n\n\n\n\n\n\n\n\n/** WEBPACK FOOTER **\n ** ./src/js/bus/html/music/main.js\n **/"],"sourceRoot":""}